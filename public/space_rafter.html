<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Relativity Rift — 3D Space Shooter</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:system-ui,Segoe UI,Roboto,Arial}
  #hud{position:fixed;top:10px;left:10px;right:10px;display:flex;justify-content:space-between;align-items:center;color:#fff;text-shadow:0 0 6px #000;pointer-events:none}
  #hud .group{display:flex;gap:10px;align-items:center}
  .pill{background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.2);padding:6px 10px;border-radius:999px}
  #center{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:28px;text-shadow:0 0 10px #000;pointer-events:none;opacity:0;transition:opacity .25s}
  #help{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);color:#d9f0ff;font-size:13px;background:rgba(0,0,20,.5);border:1px solid rgba(160,210,255,.25);border-radius:10px;padding:8px 12px;text-align:center}
  #story{position:fixed;top:54px;left:10px;max-width:520px;color:#cde7ff;background:rgba(0,20,40,.45);border:1px solid rgba(160,210,255,.25);border-radius:10px;padding:8px 10px;display:none;font-size:13px}
  #menu{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
  #menu button{cursor:pointer;background:#081a2a;color:#fff;border:1px solid #3fa9ff;padding:12px 18px;border-radius:12px;font-weight:700;box-shadow:0 0 24px rgba(63,169,255,.25),inset 0 0 12px rgba(63,169,255,.15)}
  #credits{position:fixed;bottom:10px;right:10px;color:#9cc8ff;font-size:12px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.15);border-radius:10px;padding:6px 8px}
  #a11y{position:fixed;bottom:10px;left:10px;color:#b3ffcc;font-size:12px;opacity:.9;background:rgba(0,20,0,.35);border:1px solid rgba(255,255,255,.15);border-radius:10px;padding:6px 8px}
</style>
</head>
<body>
  <div id="hud">
    <div class="group">
      <div class="pill">Score: <span id="score">0</span></div>
      <div class="pill">Level: <span id="level">1</span>/3</div>
      <div class="pill">Lives: <span id="lives">3</span></div>
      <div class="pill">HP: <span id="hp">100</span>%</div>
      <div class="pill">Shield: <span id="shield">0</span>%</div>
    </div>
    <div class="group">
      <div class="pill">Warp: <span id="warp">READY</span></div>
      <div class="pill">Rewind: <span id="rew">READY</span></div>
      <div class="pill">FPS: <span id="fps">60</span></div>
    </div>
  </div>
  <div id="story"></div>
  <div id="center"></div>
  <div id="help">
    Move: WASD/Arrows • Shoot: Space • Warp: Shift • Rewind: Q • Pause: P • Restart: R • Judge Mode: J • Graphics: G • Fullscreen: F • Gamepad supported
  </div>
  <div id="menu"><button id="startBtn">Start Mission</button></div>
  <div id="credits">Textures: NASA/JPL-Caltech • SFX: Mixkit/Freesound (attr-free)</div>
  <div id="a11y">Accessibility: text hints, color-safe VFX, reduced camera shake</div>

  <!-- SFX -->
  <audio id="sfxShoot" preload="auto" crossorigin="anonymous" src="https://cdn.freesound.org/previews/341/341695_62626-lq.mp3"></audio>
  <audio id="sfxHit" preload="auto" crossorigin="anonymous" src="https://cdn.freesound.org/previews/66/66717_931655-lq.mp3"></audio>
  <audio id="sfxBoom" preload="auto" crossorigin="anonymous" src="https://cdn.freesound.org/previews/198/198841_2859979-lq.mp3"></audio>
  <audio id="sfxPickup" preload="auto" crossorigin="anonymous" src="https://cdn.freesound.org/previews/341/341695_62626-lq.mp3"></audio>

  <!-- Three.js -->
  <script src="https://unpkg.com/three@0.157.0/build/three.min.js"></script>

<script>
(()=>{
// ---------- DOM ----------
const UI={
  score:document.getElementById('score'),
  level:document.getElementById('level'),
  lives:document.getElementById('lives'),
  hp:document.getElementById('hp'),
  shield:document.getElementById('shield'),
  warp:document.getElementById('warp'),
  rew:document.getElementById('rew'),
  fps:document.getElementById('fps'),
  center:document.getElementById('center'),
  menu:document.getElementById('menu'),
  story:document.getElementById('story'),
  startBtn:document.getElementById('startBtn')
};

// ---------- Three basics ----------
const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,2000);
camera.position.set(0,2,8);
scene.add(new THREE.HemisphereLight(0x88ccff,0x081018,1.0));
const dir=new THREE.DirectionalLight(0xffffff,0.9); dir.position.set(6,10,8); scene.add(dir);

// NASA starfield
const loader=new THREE.TextureLoader();
const skyTex=loader.load("https://www.nasa.gov/wp-content/uploads/2023/03/hs-2015-02-a-xlarge_web.jpg");
const sky=new THREE.Mesh(new THREE.SphereGeometry(900,32,32),new THREE.MeshBasicMaterial({map:skyTex,side:THREE.BackSide,depthWrite:false}));
scene.add(sky);

// ---------- Player ship ----------
const player=new THREE.Group();
const body=new THREE.Mesh(new THREE.ConeGeometry(0.5,1.8,14),new THREE.MeshStandardMaterial({color:0x66ccff,metalness:.7,roughness:.25}));
body.rotation.x=Math.PI/2;
const core=new THREE.Mesh(new THREE.CylinderGeometry(0.15,0.15,1.15,16),new THREE.MeshStandardMaterial({color:0x2244ff,emissive:0x112288,emissiveIntensity:.7,metalness:.7}));
core.position.z=-0.1;
const thruster=new THREE.Mesh(new THREE.ConeGeometry(0.18,0.6,14),new THREE.MeshBasicMaterial({color:0x55ddff,transparent:true,opacity:.7}));
thruster.position.set(0,0,.8); thruster.rotation.x=-Math.PI/2;
player.add(body,core,thruster); player.position.set(0,0,0); scene.add(player);

// ---------- State ----------
let keys={}, paused=true, started=false, judgeMode=false, lowGraphics=false;
const state={
  score:0, level:1, lives:3, hp:100, shield:0,
  time:0,lastSpawn:0,spawnInterval:1.5,
  bullets:[], enemies:[], asteroids:[], pickups:[], boss:null, wells:[],
  warp:{active:false, energy:100, cooldown:0},
  rewind:{buffer:[], active:false, cooldown:0, max:180}, // ~3s @ 60fps
  fpsBuf:[], tLast:performance.now()
};

// ---------- Input ----------
addEventListener('keydown',e=>{
  keys[e.code]=true;
  if(e.code==='KeyP'&&started) togglePause();
  if(e.code==='KeyR'&&started) restart();
  if(e.code==='Space') shoot();
  if(e.code==='KeyJ'){judgeMode=!judgeMode; note(judgeMode?'Judge Mode ON':'Judge Mode OFF');}
  if(e.code==='KeyG'){lowGraphics=!lowGraphics; renderer.setPixelRatio(lowGraphics?1:Math.min(devicePixelRatio,2)); note(lowGraphics?'Graphics: Performance':'Graphics: Quality');}
  if(e.code==='KeyF') toggleFullscreen();
});
addEventListener('keyup',e=>{keys[e.code]=false;});

// Gamepad polling
function gamepadInput(){
  const gp=navigator.getGamepads?.()[0]; if(!gp) return {x:0,y:0,shoot:false,warp:false,rew:false};
  const x=gp.axes[0]||0, y=gp.axes[1]||0;
  return {
    x:Math.abs(x)>0.15?x:0,
    y:Math.abs(y)>0.15?y:0,
    shoot:gp.buttons[0]?.pressed, // A
    warp:gp.buttons[5]?.pressed,  // RB
    rew:gp.buttons[4]?.pressed    // LB
  };
}

// ---------- UI helpers ----------
function hud(){ UI.score.textContent=state.score; UI.level.textContent=state.level; UI.lives.textContent=state.lives; UI.hp.textContent=Math.max(0,Math.floor(state.hp)); UI.shield.textContent=Math.max(0,Math.floor(state.shield)); UI.warp.textContent=state.warp.cooldown>0?'COOLDOWN':(state.warp.energy>0?'READY':'EMPTY'); UI.rew.textContent=state.rewind.cooldown>0?'COOLDOWN':'READY'; }
function note(msg,ms=1200){ UI.center.textContent=msg; UI.center.style.opacity='1'; setTimeout(()=>UI.center.style.opacity='0',ms); }
function story(msg,ms=2800){ UI.story.textContent=msg; UI.story.style.display='block'; setTimeout(()=>UI.story.style.display='none',ms); }
function togglePause(){ paused=!paused; note(paused?'Paused':'Resume'); }
function toggleFullscreen(){ if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }

// ---------- Spawning ----------
function spawnEnemy(){
  const e=new THREE.Mesh(new THREE.DodecahedronGeometry(0.48,0),
    new THREE.MeshStandardMaterial({color:0xff6666,metalness:.45,roughness:.7,emissive:0x220000}));
  e.position.set((Math.random()*14-7),(Math.random()*6-3),-22);
  e.userData={hp:30+state.level*12, vel:new THREE.Vector3((Math.random()-0.5)*0.05*state.level,(Math.random()-0.5)*0.05*state.level,0.18+state.level*0.06)};
  scene.add(e); state.enemies.push(e);
}
function spawnAsteroid(){
  const a=new THREE.Mesh(new THREE.IcosahedronGeometry(0.6+Math.random()*0.9,0),
    new THREE.MeshStandardMaterial({color:0xaaaaaa,roughness:.95,metalness:.1}));
  a.position.set((Math.random()*18-9),(Math.random()*10-5),-30);
  a.userData={rot:new THREE.Vector3(Math.random()*0.01,Math.random()*0.01,0), vel:new THREE.Vector3((Math.random()-0.5)*0.02,(Math.random()-0.5)*0.02,0.14+Math.random()*0.09)};
  scene.add(a); state.asteroids.push(a);
}
function spawnPickup(){
  const p=new THREE.Mesh(new THREE.TorusGeometry(0.4,0.12,12,24),new THREE.MeshStandardMaterial({color:0x55ffaa,emissive:0x114422,metalness:.6}));
  p.position.set((Math.random()*12-6),(Math.random()*6-3),-20);
  p.userData={type:'shield',rot:0};
  scene.add(p); state.pickups.push(p);
}
function spawnWell(){
  const w=new THREE.Mesh(new THREE.SphereGeometry(1.2,24,24),new THREE.MeshBasicMaterial({color:0x2233aa,transparent:true,opacity:0.35}));
  w.position.set((Math.random()*8-4),(Math.random()*6-3),-16);
  w.userData={strength:12,radius:3,pulse:0};
  scene.add(w); state.wells.push(w);
}
function spawnBoss(){
  const b=new THREE.Mesh(new THREE.TorusKnotGeometry(1.2,0.35,140,20),new THREE.MeshStandardMaterial({color:0xffcc55,metalness:.85,roughness:.2,emissive:0x442200,emissiveIntensity:.6}));
  b.position.set(0,0,-28); b.userData={hp:700,t:0};
  scene.add(b); state.boss=b; note('⚠️ Flagship incoming!');
}

// ---------- Bullets ----------
function shoot(){
  if(paused||!started) return;
  const geo=new THREE.SphereGeometry(0.08,8,8);
  const mat=new THREE.MeshBasicMaterial({color:0x99ddff});
  const bullet=new THREE.Mesh(geo,mat);
  bullet.position.copy(player.position); bullet.position.z-=0.6;
  bullet.userData={vel:new THREE.Vector3(0,0,-1.1), life:2.5};
  scene.add(bullet); state.bullets.push(bullet);
  try{const a=document.getElementById('sfxShoot'); a.currentTime=0; a.play();}catch{}
}

// ---------- Collision ----------
function hit(a,ra,b,rb){ return a.position.distanceTo(b.position)<(ra+rb); }

// ---------- Rewind buffer ----------
function pushRewind(){
  if(state.rewind.active) return;
  state.rewind.buffer.push(player.position.clone());
  if(state.rewind.buffer.length>state.rewind.max) state.rewind.buffer.shift();
}
function doRewind(dt){
  if(state.rewind.cooldown>0){ state.rewind.cooldown-=dt; return; }
  const want=(keys['KeyQ']||gamepadInput().rew);
  if(!want) return;
  if(state.rewind.buffer.length<20){ note('Rewind not ready'); state.rewind.cooldown=1.0; return; }
  state.rewind.active=true; note('↺ Rewinding…',600);
  const steps=state.rewind.buffer.splice(-60); // ~1s fast rewind
  const i=setInterval(()=>{
    if(!steps.length){ clearInterval(i); state.rewind.active=false; state.rewind.cooldown=3.0; return; }
    player.position.copy(steps.pop());
  },8);
}

// ---------- Warp (time-dilation bubble) ----------
let globalTimeScale=1.0;
function handleWarp(dt){
  if(state.warp.cooldown>0) state.warp.cooldown=Math.max(0,state.warp.cooldown-dt);
  const want=(keys['ShiftLeft']||keys['ShiftRight']||gamepadInput().warp);
  if(want && state.warp.energy>0){
    state.warp.active=true; globalTimeScale=0.45; state.warp.energy-=40*dt;
    if(state.warp.energy<=0){ state.warp.energy=0; state.warp.cooldown=4.0; }
  } else {
    state.warp.active=false; globalTimeScale=1.0;
    if(state.warp.energy<100 && state.warp.cooldown<=0) state.warp.energy=Math.min(100,state.warp.energy+15*dt);
  }
}

// ---------- Start/Restart ----------
UI.startBtn.addEventListener('click',()=>{
  UI.menu.style.display='none'; started=true; paused=false; hud();
  story('Mission: Stabilize three wormhole beacons. Your prototype relativity drive bends time around you. Avoid debris, neutralize hostiles, protect the beacons.');
});
function restart(){
  [...state.bullets,...state.enemies,...state.asteroids,...state.pickups,...state.wells].forEach(o=>scene.remove(o));
  if(state.boss){scene.remove(state.boss); state.boss=null;}
  Object.assign(state,{score:0,level:1,lives:3,hp:100,shield:0,time:0,lastSpawn:0,spawnInterval:1.5,bullets:[],enemies:[],asteroids:[],pickups:[],wells:[],warp:{active:false,energy:100,cooldown:0},rewind:{buffer:[],active:false,cooldown:0,max:180}});
  player.position.set(0,0,0); camera.position.set(0,2,8); paused=false; note('Mission restarted'); hud();
}

// ---------- Loop ----------
addEventListener('resize',()=>{renderer.setSize(innerWidth,innerHeight); camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix();});

function gameOver(){ paused=true; note('Game Over — Press R to Restart',2600); }
function win(){ paused=true; note('All beacons stable. You win!'); }

function step(now){
  requestAnimationFrame(step);
  // FPS & dt
  const dtRaw=Math.min(0.05,(now-state.tLast)/1000); state.tLast=now;
  state.fpsBuf.push(1/dtRaw); if(state.fpsBuf.length>10) state.fpsBuf.shift();
  UI.fps.textContent=Math.round(state.fpsBuf.reduce((a,b)=>a+b,0)/state.fpsBuf.length);

  if(!started||paused){ renderer.render(scene,camera); return; }

  // Judge mode: auto fly & shoot
  if(judgeMode){ const s=Math.sin(state.time*0.7); player.position.x=s*6.5; player.position.y=Math.cos(state.time*0.9)*2.5; if(Math.random()<0.3) shoot(); }

  // Global time scale from warp
  handleWarp(dtRaw);
  const dt=dtRaw*globalTimeScale;
  state.time+=dt;

  // Sky
  sky.rotation.y+=0.0007*globalTimeScale;

  // Input
  const gp=gamepadInput();
  const vx=((keys['KeyA']||keys['ArrowLeft'])?-1:0)+((keys['KeyD']||keys['ArrowRight'])?1:0) + gp.x;
  const vy=((keys['KeyS']||keys['ArrowDown'])?1:0)+((keys['KeyW']||keys['ArrowUp'])?-1:0) + gp.y;
  const speed=5.2*(state.warp.active?0.9:1.0);
  player.position.x=THREE.MathUtils.clamp(player.position.x+vx*speed*dt,-7.5,7.5);
  player.position.y=THREE.MathUtils.clamp(player.position.y+vy*speed*dt,-4.0,4.0);
  player.rotation.z=THREE.MathUtils.lerp(player.rotation.z,-vx*0.25,0.15);
  thruster.material.opacity=0.6+Math.min(0.4,Math.abs(vx)+Math.abs(vy))*0.2;

  if(gp.shoot) shoot();
  if(keys['KeyP']){} // handled on keydown
  if(keys['KeyR']){} // handled on keydown

  // Rewind buffer & execution
  pushRewind();
  doRewind(dt);

  // Spawns & level scripting
  if(state.time-state.lastSpawn>state.spawnInterval){ state.lastSpawn=state.time; spawnEnemy(); if(state.level>=2 && Math.random()<0.55) spawnAsteroid(); if(Math.random()<0.1) spawnPickup(); }
  if(state.level===1){
    state.spawnInterval=1.5;
    if(state.score>=300){ state.level=2; hud(); note('Level 2 — Debris Belt'); spawnWell(); story('Beacon 2 destabilizing—debris density increasing. Use warp to survive.'); }
  } else if(state.level===2){
    state.spawnInterval=1.15; if(Math.random()<0.002) spawnWell();
    if(state.score>=950){ state.level=3; hud(); note('Level 3 — Flagship Encounter'); story('Enemy flagship detected near Beacon 3. Disable it to stabilize the rift.'); setTimeout(spawnBoss,1100); }
  } else if(state.level===3){
    state.spawnInterval=0.95;
  }

  // Gravity wells
  for(const w of state.wells){
    w.userData.pulse+=dt; w.scale.setScalar(1+Math.sin(w.userData.pulse*2)*0.1);
    const targets=[player,...state.enemies,...state.asteroids];
    for(const o of targets){
      const v=w.position.clone().sub(o.position); const d=v.length();
      if(d<w.userData.radius*5){ const f=(w.userData.strength/(d*d+1))*dt; o.position.add(v.normalize().multiplyScalar(f)); }
    }
  }

  // Bullets
  for(let i=state.bullets.length-1;i>=0;i--){
    const b=state.bullets[i]; b.position.add(b.userData.vel.clone().multiplyScalar(40*dt)); b.userData.life-=dt;
    // warp trail wobble
    if(state.warp.active){ b.position.x+=Math.sin((state.time+i)*12)*0.02; }
    if(b.userData.life<=0){ scene.remove(b); state.bullets.splice(i,1); }
  }

  // Enemies
  for(let i=state.enemies.length-1;i>=0;i--){
    const e=state.enemies[i];
    e.position.z+=e.userData.vel.z*(12*dt);
    e.position.x+=e.userData.vel.x*(60*dt);
    e.position.y+=e.userData.vel.y*(60*dt);
    e.rotation.x+=0.6*dt; e.rotation.y+=0.4*dt;
    // slight homing (more during warp to feel dramatic)
    if(Math.random()<0.2){ e.position.add(player.position.clone().sub(e.position).normalize().multiplyScalar(state.warp.active?0.12:0.07)); }
    // collide with player
    if(hit(e,0.6,player,0.6)){
      try{const a=document.getElementById('sfxHit'); a.currentTime=0;a.play();}catch{}
      scene.remove(e); state.enemies.splice(i,1);
      if(state.shield>0){ state.shield=Math.max(0,state.shield-35); }
      else { state.hp-=18; }
      if(state.hp<=0){ state.lives--; state.hp=100; if(state.lives<0) return gameOver(); note('You were hit! −1 life'); }
      hud();
    }
    // bullets vs enemies
    for(let j=state.bullets.length-1;j>=0;j--){
      const b=state.bullets[j];
      if(hit(e,0.6,b,0.1)){
        e.userData.hp-=40; scene.remove(b); state.bullets.splice(j,1);
        if(e.userData.hp<=0){ try{const a=document.getElementById('sfxBoom'); a.currentTime=0;a.play();}catch{} scene.remove(e); state.enemies.splice(i,1); state.score+=45; hud(); }
        break;
      }
    }
    if(e.position.z>8){ scene.remove(e); state.enemies.splice(i,1); state.score=Math.max(0,state.score-10); hud(); }
  }

  // Asteroids
  for(let i=state.asteroids.length-1;i>=0;i--){
    const a=state.asteroids[i];
    a.position.z+=a.userData.vel.z*(12*dt);
    a.position.x+=a.userData.vel.x*(60*dt);
    a.position.y+=a.userData.vel.y*(60*dt);
    a.rotation.x+=a.userData.rot.x; a.rotation.y+=a.userData.rot.y;

    if(hit(a,0.8,player,0.6)){
      try{const s=document.getElementById('sfxHit'); s.currentTime=0;s.play();}catch{}
      scene.remove(a); state.asteroids.splice(i,1);
      if(state.shield>0){ state.shield=Math.max(0,state.shield-25); }
      else { state.hp-=24; }
      if(state.hp<=0){ state.lives--; state.hp=100; if(state.lives<0) return gameOver(); note('Rocked! −1 life'); }
      hud();
    }
    for(let j=state.bullets.length-1;j>=0;j--){
      const b=state.bullets[j];
      if(hit(a,0.8,b,0.1)){ scene.remove(b); state.bullets.splice(j,1); scene.remove(a); state.asteroids.splice(i,1); state.score+=15; hud(); break; }
    }
    if(a.position.z>9){ scene.remove(a); state.asteroids.splice(i,1); }
  }

  // Pickups
  for(let i=state.pickups.length-1;i>=0;i--){
    const p=state.pickups[i]; p.rotation.y+=1.4*dt; p.position.z+=0.7*dt;
    if(hit(p,0.6,player,0.6)){ try{const s=document.getElementById('sfxPickup'); s.currentTime=0;s.play();}catch{} state.shield=Math.min(100,state.shield+40); scene.remove(p); state.pickups.splice(i,1); hud(); note('Shield +40'); }
    if(p.position.z>8){ scene.remove(p); state.pickups.splice(i,1); }
  }

  // Boss
  if(state.boss){
    const b=state.boss; b.userData.t+=dt; b.rotation.x+=0.3*dt; b.rotation.y+=0.25*dt;
    b.position.x=Math.sin(b.userData.t*1.2)*3.7; b.position.y=Math.cos(b.userData.t*0.9)*2.1;
    if(Math.floor(state.time*2)%2===0 && Math.random()<0.1) spawnEnemy();

    // boss collisions
    for(let j=state.bullets.length-1;j>=0;j--){
      const bullet=state.bullets[j];
      if(hit(b,1.3,bullet,0.1)){ b.userData.hp-=18; scene.remove(bullet); state.bullets.splice(j,1); state.score+=8; hud();
        if(b.userData.hp<=0){ try{const s=document.getElementById('sfxBoom'); s.currentTime=0;s.play();}catch{} scene.remove(b); state.boss=null; state.score+=600; hud(); win(); }
      }
    }
    if(hit(b,1.2,player,0.6)){ try{const s=document.getElementById('sfxHit'); s.currentTime=0;s.play();}catch{} if(state.shield>0){ state.shield=Math.max(0,state.shield-50);} else { state.hp-=50; } if(state.hp<=0){ state.lives--; state.hp=100; if(state.lives<0) return gameOver(); note('Flagship ram! −1 life'); } hud(); }
  }

  renderer.render(scene,camera);
}
requestAnimationFrame(step);

// ---------- Helpers ----------
function startAttract(){ judgeMode=true; UI.menu.style.display='none'; started=true; paused=false; note('Attract mode: J to toggle'); }
function gameIntro(){
  note('Relativity Rift'); story('Year 2079: Wormhole beacons destabilize near Mars orbit. As the test pilot of the XR-Δ ship, use your relativity drive to bend time and protect the beacons.');
}
gameIntro();

// Pause/Restart
function onKey(e){
  if(e.code==='KeyR') restart();
}
addEventListener('keydown',onKey);

})();</script>
</body>
</html>